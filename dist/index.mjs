import {createContext,useCallback,useState,useEffect,useContext}from'react';import {jsx,jsxs,Fragment}from'react/jsx-runtime';function $(n){let e=typeof Storage<"u",a=useCallback(t=>{if(!e){console.warn("Storage is not available, cannot save consent");return}try{if(!t||!t.decisions||!Array.isArray(t.decisions)||t.decisions.length===0){console.error("Cannot save invalid consent record",t);return}let s={...t,decisions:[...t.decisions]},d=JSON.stringify(s);console.log(`Saving consent to localStorage (key: ${n}):`,s),localStorage.setItem(n,d);}catch(s){console.error("Failed to save consent to localStorage:",s);}},[n,e]),i=useCallback(()=>{if(!e)return console.warn("Storage is not available, cannot load consent"),null;try{console.log(`Loading consent from localStorage (key: ${n})`);let t=localStorage.getItem(n);if(!t)return console.log("No saved consent found in localStorage"),null;console.log("Found serialized consent record:",t.substring(0,100)+"...");let s=JSON.parse(t);if(console.log("Parsed consent record:",s),!s||!s.decisions||!Array.isArray(s.decisions)||!s.version||!s.sessionId||!s.lastUpdated)return console.warn("Consent record missing required fields, discarding",s),null;let d=["accepted","rejected","pending"],l=s.decisions.filter(o=>{let b=o&&o.categoryId&&typeof o.categoryId=="string"&&o.status&&d.indexOf(o.status)!==-1&&o.timestamp&&o.version;return b||console.warn("Invalid decision found:",o),b});if(l.length!==s.decisions.length&&console.warn("Some consent decisions were invalid and filtered out","Valid:",l.length,"Total:",s.decisions.length),l.length===0)return console.warn("No valid consent decisions found, discarding record"),null;let p={...s,lastUpdated:new Date(s.lastUpdated),decisions:l.map(o=>({...o,timestamp:new Date(o.timestamp)}))};return console.log("Successfully loaded consent record with",p.decisions.length,"valid decisions:",p.decisions.map(o=>`${o.categoryId}:${o.status}`).join(", ")),p}catch(t){return console.warn("Failed to load consent from localStorage:",t),null}},[n,e]),u=useCallback(()=>{if(!e){console.warn("Storage is not available, cannot clear consent");return}try{console.log(`Clearing consent from localStorage (key: ${n})`),localStorage.removeItem(n),console.log("Consent data cleared successfully");}catch(t){console.error("Failed to clear consent from localStorage:",t);}},[n,e]);return {saveConsent:a,loadConsent:i,clearConsent:u,isStorageAvailable:e}}function z(){return "session_"+Date.now()+"_"+Math.random().toString(36).substring(2,15)}function w(n,e,a,i){return {userId:i,sessionId:n,decisions:e,lastUpdated:new Date,version:a,userAgent:typeof navigator<"u"?navigator.userAgent:void 0}}function ne(n,e){return !!(n&&n.version===e&&n.decisions&&Array.isArray(n.decisions)&&n.lastUpdated&&n.sessionId)}function te(n,e){return n?n.decisions.find(i=>i.categoryId===e)?.status==="accepted":false}function oe(n,e){let a=[...n];return e.forEach(i=>{let u=a.findIndex(t=>t.categoryId===i.categoryId);u>=0?a[u]=i:a.push(i);}),a}function se(n,e){if(!n.lastUpdated)return  true;let a=new Date(n.lastUpdated);return a.setDate(a.getDate()+e),a<=new Date}function re(n){return {userId:n.userId,sessionId:n.sessionId,decisions:n.decisions.map(e=>({categoryId:e.categoryId,status:e.status,timestamp:new Date(e.timestamp),version:e.version})),lastUpdated:new Date(n.lastUpdated),version:n.version,ipAddress:n.ipAddress,userAgent:n.userAgent}}function F(n){let e=document.documentElement;e.style.setProperty("--consent-primary-color",n.primaryColor),e.style.setProperty("--consent-secondary-color",n.secondaryColor),e.style.setProperty("--consent-background-color",n.backgroundColor),e.style.setProperty("--consent-text-color",n.textColor),e.style.setProperty("--consent-border-color",n.borderColor),e.style.setProperty("--consent-border-radius",n.borderRadius),e.style.setProperty("--consent-font-family",n.fontFamily),e.style.setProperty("--consent-font-size",n.fontSize),e.style.setProperty("--consent-button-style",n.buttonStyle),e.style.setProperty("--consent-shadow",n.shadow?"0 4px 6px rgba(0, 0, 0, 0.1)":"none");}function ae(){let n=document.documentElement;["--consent-primary-color","--consent-secondary-color","--consent-background-color","--consent-text-color","--consent-border-color","--consent-border-radius","--consent-font-family","--consent-font-size","--consent-button-style","--consent-shadow"].forEach(a=>{n.style.removeProperty(a);});}function ie(){return {primaryColor:"#007bff",secondaryColor:"#6c757d",backgroundColor:"#ffffff",textColor:"#212529",borderColor:"#dee2e6",borderRadius:"0.375rem",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",buttonStyle:"solid",shadow:true}}function ce(){return {primaryColor:"#0d6efd",secondaryColor:"#adb5bd",backgroundColor:"#212529",textColor:"#ffffff",borderColor:"#495057",borderRadius:"0.375rem",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",buttonStyle:"solid",shadow:true}}var G=createContext(void 0);function ue({children:n,config:e}){let[a,i]=useState(false),[u,t]=useState(false),[s,d]=useState(null),[l]=useState(()=>z()),{saveConsent:p,loadConsent:o,clearConsent:b}=$(e.settings.storageKey);useEffect(()=>{console.log("Initializing consent system with storage key:",e.settings.storageKey);let r=o();if(console.log("Loaded consent from storage:",r?"found":"not found"),r&&r.version===e.settings.version){console.log("Consent version matches current version:",e.settings.version);let g=new Date(r.lastUpdated);if(g.setDate(g.getDate()+e.settings.expirationDays),g>new Date)if(console.log("Consent is not expired, valid until:",g),e.settings.categories.every(T=>r.decisions.some(C=>C.categoryId===T.id))){console.log("All categories present in saved consent, using it",r.decisions),d(r);return}else {console.log("Some categories missing in saved consent, merging with defaults");let T=[...r.decisions];e.settings.categories.forEach(A=>{r.decisions.some(ee=>ee.categoryId===A.id)||T.push({categoryId:A.id,status:A.required||A.defaultValue?"accepted":"rejected",timestamp:new Date,version:e.settings.version});});let C=w(r.sessionId,T,e.settings.version);console.log("Setting merged consent record:",C),d(C),p(C);return}else console.log("Consent is expired, expired on:",g);}else console.log("No valid consent found or version mismatch");let c=e.settings.categories.map(g=>({categoryId:g.id,status:g.required||g.defaultValue?"accepted":"rejected",timestamp:new Date,version:e.settings.version})),m=w(l,c,e.settings.version);console.log("Setting initial default consent record:",m),d(m);let h=e.settings.autoShowDelay||0;setTimeout(()=>{(!r||r.version!==e.settings.version)&&(console.log("Showing consent banner"),i(true),e.onBannerShow?.());},h);},[e,o]),useEffect(()=>{e.theme&&F(e.theme);},[e.theme]),useEffect(()=>{if(e.settings.respectDoNotTrack&&navigator.doNotTrack==="1"){let r=w(l,e.settings.categories.map(c=>({categoryId:c.id,status:c.required?"accepted":"rejected",timestamp:new Date,version:e.settings.version})),e.settings.version);d(r),p(r),i(false);}},[e.settings,l,p]);let D=useCallback(()=>{i(true),e.onBannerShow?.();},[e]),_=useCallback(()=>{i(false),e.onBannerHide?.();},[e]),k=useCallback(()=>{t(true);},[]),B=useCallback(()=>{t(false);},[]),x=useCallback(r=>{let c=w(l,r,e.settings.version);return d(c),p(c),e.onConsentChange?.(c),c},[l,e,p]),P=useCallback(()=>{let r=e.settings.categories.map(c=>({categoryId:c.id,status:"accepted",timestamp:new Date,version:e.settings.version}));x(r),i(false),t(false),e.onBannerHide?.();},[e,x]),V=useCallback(()=>{let r=e.settings.categories.map(c=>({categoryId:c.id,status:c.required?"accepted":"rejected",timestamp:new Date,version:e.settings.version}));x(r),i(false),t(false),e.onBannerHide?.();},[e,x]),j=useCallback((r,c)=>{console.log(`Updating consent for category ${r} to ${c?"accepted":"rejected"}`);let m;s&&Array.isArray(s.decisions)?(console.log("Using existing consent record decisions"),m=[...s.decisions]):(console.log("No existing consent record, creating default decisions"),m=e.settings.categories.map(C=>({categoryId:C.id,status:C.defaultValue?"accepted":"rejected",timestamp:new Date,version:e.settings.version})));let h=m.filter(C=>C.categoryId!==r),g={categoryId:r,status:c?"accepted":"rejected",timestamp:new Date,version:e.settings.version},q=[...h,g];return console.log("Updated decisions:",q.map(C=>`${C.categoryId}: ${C.status}`).join(", ")),x(q)},[s,e.settings.version,e.settings.categories,x,p]),M=useCallback(r=>{if(!s)return e.settings.categories.find(g=>g.id===r)?.defaultValue?"accepted":"pending";let c=s.decisions.find(h=>h.categoryId===r);return c?c.status:e.settings.categories.find(h=>h.id===r)?.defaultValue?"accepted":"pending"},[s,e.settings.categories]),X=useCallback(()=>s,[s]),Y=useCallback(r=>M(r)==="accepted",[M]),Z=useCallback(()=>{console.log("Resetting consent to default state"),b();let r=e.settings.categories.map(m=>({categoryId:m.id,status:m.required||m.defaultValue?"accepted":"rejected",timestamp:new Date,version:e.settings.version}));console.log("Initial decisions after reset:",r.map(m=>`${m.categoryId}: ${m.status}`).join(", "));let c=w(l,r,e.settings.version);d(c),i(true),t(false),e.onBannerShow?.(),console.log("Consent reset complete, banner shown, waiting for user action");},[b,e,e.settings.categories,e.settings.version]),K={isVisible:a,showBanner:D,hideBanner:_,showPreferences:k,hidePreferences:B,acceptAll:P,rejectAll:V,updateConsent:j,getConsent:M,getAllConsent:X,hasConsent:Y,resetConsent:Z,isPreferencesVisible:u,consentRecord:s,config:e};return jsx(G.Provider,{value:K,children:n})}function L(){let n=useContext(G);if(n===void 0)throw new Error("useConsentContext must be used within a ConsentProvider");return n}function R(){return L()}function me({className:n="",style:e={},onAcceptAll:a,onRejectAll:i,onManagePreferences:u,children:t}){let{isVisible:s,acceptAll:d,rejectAll:l,showPreferences:p,config:o}=R();if(!s)return null;let b=()=>{d(),a?.();},D=()=>{l(),i?.();},_=()=>{p(),u?.();},k=["consent-banner",`consent-banner--${o.banner.position}`,`consent-banner--${o.banner.layout}`,o.banner.animation?"consent-banner--animated":"",n].filter(Boolean).join(" ");return jsxs(Fragment,{children:[o.banner.backdrop&&jsx("div",{className:"consent-backdrop"}),jsx("div",{className:k,style:e,role:"dialog","aria-labelledby":"consent-title","aria-describedby":"consent-description",children:t||jsxs("div",{className:"consent-banner__content",children:[jsxs("div",{className:"consent-banner__text",children:[jsx("h3",{id:"consent-title",className:"consent-banner__title",children:o.texts.title}),jsx("p",{id:"consent-description",className:"consent-banner__description",children:o.texts.description}),(o.texts.learnMoreUrl||o.texts.privacyPolicyUrl)&&jsxs("div",{className:"consent-banner__links",children:[o.texts.learnMoreUrl&&jsx("a",{href:o.texts.learnMoreUrl,target:"_blank",rel:"noopener noreferrer",className:"consent-banner__link",children:o.texts.learnMoreText}),o.texts.privacyPolicyUrl&&jsx("a",{href:o.texts.privacyPolicyUrl,target:"_blank",rel:"noopener noreferrer",className:"consent-banner__link",children:"Privacy Policy"})]})]}),jsxs("div",{className:"consent-banner__actions",children:[o.settings.showAcceptAll&&jsx("button",{onClick:b,className:"consent-button consent-button--primary",type:"button",children:o.texts.acceptAllText}),o.settings.showDeclineAll&&jsx("button",{onClick:D,className:"consent-button consent-button--secondary",type:"button",children:o.texts.rejectAllText}),o.settings.showManagePreferences&&jsx("button",{onClick:_,className:"consent-button consent-button--ghost",type:"button",children:o.texts.managePreferencesText})]}),o.banner.showCloseButton&&jsx("button",{onClick:D,className:"consent-banner__close","aria-label":o.texts.closeText,type:"button",children:"\xD7"}),o.texts.poweredByText&&jsx("div",{className:"consent-banner__powered-by",children:o.texts.poweredByText})]})})]})}function J({checked:n,onChange:e,disabled:a=false,size:i="md",className:u="",label:t}){let s=["consent-toggle",`consent-toggle--${i}`,n?"consent-toggle--checked":"",a?"consent-toggle--disabled":"",u].filter(Boolean).join(" ");return jsxs("label",{className:s,children:[jsx("input",{type:"checkbox",checked:n,onChange:l=>{a||e(l.target.checked);},disabled:a,className:"consent-toggle__input","aria-label":t}),jsx("span",{className:"consent-toggle__slider"}),t&&jsx("span",{className:"consent-toggle__label",children:t})]})}function W({category:n,value:e,onChange:a,disabled:i=false,className:u=""}){let t=["consent-category",i?"consent-category--disabled":"",n.required?"consent-category--required":"",u].filter(Boolean).join(" ");return jsxs("div",{className:t,children:[jsxs("div",{className:"consent-category__header",children:[jsx("h4",{className:"consent-category__name",children:n.name}),jsx(J,{checked:e,onChange:a,disabled:i,size:"md"})]}),jsx("p",{className:"consent-category__description",children:n.description}),n.required&&jsx("span",{className:"consent-category__required-badge",children:"Required"})]})}function fe({isOpen:n,onClose:e,className:a="",style:i={},showBackdrop:u=true}){let{config:t,consentRecord:s,updateConsent:d,acceptAll:l,rejectAll:p,hidePreferences:o,hideBanner:b,getConsent:D}=R();if(!n)return null;let _=()=>{o(),b(),e();},k=()=>{l(),e();},B=()=>{p(),e();},x=["consent-modal",a].filter(Boolean).join(" ");return jsxs(Fragment,{children:[u&&jsx("div",{className:"consent-modal__backdrop",onClick:e,role:"presentation"}),jsx("div",{className:x,style:i,role:"dialog","aria-labelledby":"consent-modal-title","aria-modal":"true",children:jsxs("div",{className:"consent-modal__content",children:[jsxs("div",{className:"consent-modal__header",children:[jsx("h2",{id:"consent-modal-title",className:"consent-modal__title",children:t.texts.managePreferencesText}),jsx("button",{onClick:e,className:"consent-modal__close","aria-label":t.texts.closeText,type:"button",children:"\xD7"})]}),jsxs("div",{className:"consent-modal__body",children:[jsx("p",{className:"consent-modal__description",children:t.texts.description}),jsx("div",{className:"consent-modal__categories",children:t.settings.categories.map(P=>{let V=D(P.id)==="accepted";return jsx(W,{category:P,value:V,onChange:j=>d(P.id,j),disabled:P.required},P.id)})}),(t.texts.privacyPolicyUrl||t.texts.cookiePolicyUrl)&&jsxs("div",{className:"consent-modal__links",children:[t.texts.privacyPolicyUrl&&jsx("a",{href:t.texts.privacyPolicyUrl,target:"_blank",rel:"noopener noreferrer",className:"consent-modal__link",children:"Privacy Policy"}),t.texts.cookiePolicyUrl&&jsx("a",{href:t.texts.cookiePolicyUrl,target:"_blank",rel:"noopener noreferrer",className:"consent-modal__link",children:"Cookie Policy"})]})]}),jsx("div",{className:"consent-modal__footer",children:jsxs("div",{className:"consent-modal__actions",children:[jsx("button",{onClick:_,className:"consent-button consent-button--primary",type:"button",children:t.texts.savePreferencesText}),t.settings.showAcceptAll&&jsx("button",{onClick:k,className:"consent-button consent-button--secondary",type:"button",children:t.texts.acceptAllText}),t.settings.showDeclineAll&&jsx("button",{onClick:B,className:"consent-button consent-button--ghost",type:"button",children:t.texts.rejectAllText})]})})]})})]})}var ve={categories:[{id:"necessary",name:"Necessary",description:"Essential cookies required for basic website functionality.",type:"necessary",required:true,defaultValue:true},{id:"analytics",name:"Analytics",description:"Cookies that help us understand how visitors interact with our website.",type:"analytics",required:false,defaultValue:false},{id:"marketing",name:"Marketing",description:"Cookies used to deliver personalized advertisements.",type:"marketing",required:false,defaultValue:false},{id:"preferences",name:"Preferences",description:"Cookies that remember your preferences and settings.",type:"preferences",required:false,defaultValue:false}],version:"1.0.0",expirationDays:365,storageKey:"asafarim-privacy-consent",showDeclineAll:true,showAcceptAll:true,showManagePreferences:true,autoShowDelay:1e3,respectDoNotTrack:true},be={position:"bottom",layout:"banner",showCloseButton:true,showCompanyLogo:false,blocking:false,animation:true,backdrop:false},xe={title:"We value your privacy",description:"We use cookies and similar technologies to provide the best experience on our website. Some are necessary for functionality, while others help us understand usage and improve our services.",acceptAllText:"Accept All",rejectAllText:"Reject All",managePreferencesText:"Manage Preferences",savePreferencesText:"Save Preferences",closeText:"Close",learnMoreText:"Learn More",poweredByText:"Powered by @asafarim/react-privacy-consent"},Ge={settings:ve,banner:be,texts:xe};export{me as ConsentBanner,W as ConsentCategory,fe as ConsentModal,ue as ConsentProvider,J as ConsentToggle,F as applyConsentTheme,w as createConsentRecord,be as defaultBannerConfig,xe as defaultConsentTexts,Ge as defaultPrivacyConsentConfig,ve as defaultPrivacySettings,z as generateSessionId,te as getConsentValue,ce as getDarkTheme,ie as getDefaultTheme,se as hasExpiredConsent,ne as isValidConsentRecord,oe as mergeConsentDecisions,ae as removeConsentTheme,re as sanitizeConsentRecord,R as useConsent,L as useConsentContext,$ as useConsentStorage};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map