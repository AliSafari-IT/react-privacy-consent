'use strict';var react=require('react'),jsxRuntime=require('react/jsx-runtime');function z(n){let e=typeof Storage<"u",a=react.useCallback(t=>{if(!e){console.warn("Storage is not available, cannot save consent");return}try{if(!t||!t.decisions||!Array.isArray(t.decisions)||t.decisions.length===0){console.error("Cannot save invalid consent record",t);return}let r={...t,decisions:[...t.decisions]},d=JSON.stringify(r);console.log(`Saving consent to localStorage (key: ${n}):`,r),localStorage.setItem(n,d);}catch(r){console.error("Failed to save consent to localStorage:",r);}},[n,e]),i=react.useCallback(()=>{if(!e)return console.warn("Storage is not available, cannot load consent"),null;try{console.log(`Loading consent from localStorage (key: ${n})`);let t=localStorage.getItem(n);if(!t)return console.log("No saved consent found in localStorage"),null;console.log("Found serialized consent record:",t.substring(0,100)+"...");let r=JSON.parse(t);if(console.log("Parsed consent record:",r),!r||!r.decisions||!Array.isArray(r.decisions)||!r.version||!r.sessionId||!r.lastUpdated)return console.warn("Consent record missing required fields, discarding",r),null;let d=["accepted","rejected","pending"],l=r.decisions.filter(o=>{let x=o&&o.categoryId&&typeof o.categoryId=="string"&&o.status&&d.indexOf(o.status)!==-1&&o.timestamp&&o.version;return x||console.warn("Invalid decision found:",o),x});if(l.length!==r.decisions.length&&console.warn("Some consent decisions were invalid and filtered out","Valid:",l.length,"Total:",r.decisions.length),l.length===0)return console.warn("No valid consent decisions found, discarding record"),null;let f={...r,lastUpdated:new Date(r.lastUpdated),decisions:l.map(o=>({...o,timestamp:new Date(o.timestamp)}))};return console.log("Successfully loaded consent record with",f.decisions.length,"valid decisions:",f.decisions.map(o=>`${o.categoryId}:${o.status}`).join(", ")),f}catch(t){return console.warn("Failed to load consent from localStorage:",t),null}},[n,e]),p=react.useCallback(()=>{if(!e){console.warn("Storage is not available, cannot clear consent");return}try{console.log(`Clearing consent from localStorage (key: ${n})`),localStorage.removeItem(n),console.log("Consent data cleared successfully");}catch(t){console.error("Failed to clear consent from localStorage:",t);}},[n,e]);return {saveConsent:a,loadConsent:i,clearConsent:p,isStorageAvailable:e}}function $(){return "session_"+Date.now()+"_"+Math.random().toString(36).substring(2,15)}function w(n,e,a,i){return {userId:i,sessionId:n,decisions:e,lastUpdated:new Date,version:a,userAgent:typeof navigator<"u"?navigator.userAgent:void 0}}function te(n,e){return !!(n&&n.version===e&&n.decisions&&Array.isArray(n.decisions)&&n.lastUpdated&&n.sessionId)}function oe(n,e){return n?n.decisions.find(i=>i.categoryId===e)?.status==="accepted":false}function se(n,e){let a=[...n];return e.forEach(i=>{let p=a.findIndex(t=>t.categoryId===i.categoryId);p>=0?a[p]=i:a.push(i);}),a}function re(n,e){if(!n.lastUpdated)return  true;let a=new Date(n.lastUpdated);return a.setDate(a.getDate()+e),a<=new Date}function ae(n){return {userId:n.userId,sessionId:n.sessionId,decisions:n.decisions.map(e=>({categoryId:e.categoryId,status:e.status,timestamp:new Date(e.timestamp),version:e.version})),lastUpdated:new Date(n.lastUpdated),version:n.version,ipAddress:n.ipAddress,userAgent:n.userAgent}}function F(n){let e=document.documentElement;e.style.setProperty("--consent-primary-color",n.primaryColor),e.style.setProperty("--consent-secondary-color",n.secondaryColor),e.style.setProperty("--consent-background-color",n.backgroundColor),e.style.setProperty("--consent-text-color",n.textColor),e.style.setProperty("--consent-border-color",n.borderColor),e.style.setProperty("--consent-border-radius",n.borderRadius),e.style.setProperty("--consent-font-family",n.fontFamily),e.style.setProperty("--consent-font-size",n.fontSize),e.style.setProperty("--consent-button-style",n.buttonStyle),e.style.setProperty("--consent-shadow",n.shadow?"0 4px 6px rgba(0, 0, 0, 0.1)":"none");}function ie(){let n=document.documentElement;["--consent-primary-color","--consent-secondary-color","--consent-background-color","--consent-text-color","--consent-border-color","--consent-border-radius","--consent-font-family","--consent-font-size","--consent-button-style","--consent-shadow"].forEach(a=>{n.style.removeProperty(a);});}function ce(){return {primaryColor:"#007bff",secondaryColor:"#6c757d",backgroundColor:"#ffffff",textColor:"#212529",borderColor:"#dee2e6",borderRadius:"0.375rem",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",buttonStyle:"solid",shadow:true}}function le(){return {primaryColor:"#0d6efd",secondaryColor:"#adb5bd",backgroundColor:"#212529",textColor:"#ffffff",borderColor:"#495057",borderRadius:"0.375rem",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",buttonStyle:"solid",shadow:true}}var G=react.createContext(void 0);function Ce({children:n,config:e}){let[a,i]=react.useState(false),[p,t]=react.useState(false),[r,d]=react.useState(null),[l]=react.useState(()=>$()),f=react.useRef(false),{saveConsent:o,loadConsent:x,clearConsent:P}=z(e.settings.storageKey);react.useEffect(()=>{if(f.current){console.log("[ConsentProvider] Already initialized, skipping");return}console.log("[ConsentProvider] useEffect triggered - initializing consent"),console.log("[ConsentProvider] Config version:",e.settings.version),console.log("[ConsentProvider] Config categories:",e.settings.categories.map(u=>u.id));let s=x();if(console.log("Loaded consent from storage:",s?"found":"not found"),s&&s.version===e.settings.version){console.log("Consent version matches current version:",e.settings.version);let u=new Date(s.lastUpdated);if(u.setDate(u.getDate()+e.settings.expirationDays),u>new Date)if(console.log("Consent is not expired, valid until:",u),e.settings.categories.every(k=>s.decisions.some(g=>g.categoryId===k.id))){console.log("[ConsentProvider] All categories present in saved consent, using it",s.decisions),console.log("[ConsentProvider] Setting consent record to:",s),d(s),console.log("[ConsentProvider] Consent record set successfully, returning early"),f.current=true;return}else {console.log("[ConsentProvider] Some categories missing in saved consent, merging with defaults");let k=[...s.decisions];e.settings.categories.forEach(N=>{s.decisions.some(ne=>ne.categoryId===N.id)||k.push({categoryId:N.id,status:N.required||N.defaultValue?"accepted":"rejected",timestamp:new Date,version:e.settings.version});});let g=w(s.sessionId,k,e.settings.version);console.log("[ConsentProvider] Setting merged consent record:",g),d(g),o(g),f.current=true;return}else console.log("[ConsentProvider] Consent is expired, expired on:",u);}else console.log("[ConsentProvider] No valid consent found or version mismatch"),s&&(console.log("[ConsentProvider] Saved consent version:",s.version),console.log("[ConsentProvider] Expected version:",e.settings.version));console.log("[ConsentProvider] Creating default consent record");let c=e.settings.categories.map(u=>({categoryId:u.id,status:u.required||u.defaultValue?"accepted":"rejected",timestamp:new Date,version:e.settings.version})),C=w(l,c,e.settings.version);console.log("[ConsentProvider] Setting initial default consent record:",C),d(C);let h=e.settings.autoShowDelay||0;setTimeout(()=>{(!s||s.version!==e.settings.version)&&(console.log("[ConsentProvider] Showing consent banner"),i(true),e.onBannerShow?.());},h),f.current=true;},[]),react.useEffect(()=>{e.theme&&F(e.theme);},[e.theme]),react.useEffect(()=>{if(e.settings.respectDoNotTrack&&navigator.doNotTrack==="1"){let s=w(l,e.settings.categories.map(c=>({categoryId:c.id,status:c.required?"accepted":"rejected",timestamp:new Date,version:e.settings.version})),e.settings.version);d(s),o(s),i(false);}},[e.settings,l,o]);let S=react.useCallback(()=>{i(true),e.onBannerShow?.();},[e]),_=react.useCallback(()=>{i(false),e.onBannerHide?.();},[e]),U=react.useCallback(()=>{t(true);},[]),B=react.useCallback(()=>{t(false);},[]),y=react.useCallback(s=>{let c=w(l,s,e.settings.version);return d(c),o(c),e.onConsentChange?.(c),c},[l,e,o]),V=react.useCallback(()=>{let s=e.settings.categories.map(c=>({categoryId:c.id,status:"accepted",timestamp:new Date,version:e.settings.version}));y(s),i(false),t(false),e.onBannerHide?.();},[e,y]),j=react.useCallback(()=>{let s=e.settings.categories.map(c=>({categoryId:c.id,status:c.required?"accepted":"rejected",timestamp:new Date,version:e.settings.version}));y(s),i(false),t(false),e.onBannerHide?.();},[e,y]),X=react.useCallback((s,c)=>{console.log(`Updating consent for category ${s} to ${c?"accepted":"rejected"}`);let C;r&&Array.isArray(r.decisions)?(console.log("Using existing consent record decisions"),C=[...r.decisions]):(console.log("No existing consent record, creating default decisions"),C=e.settings.categories.map(g=>({categoryId:g.id,status:g.defaultValue?"accepted":"rejected",timestamp:new Date,version:e.settings.version})));let h=C.filter(g=>g.categoryId!==s),u={categoryId:s,status:c?"accepted":"rejected",timestamp:new Date,version:e.settings.version},q=[...h,u];return console.log("Updated decisions:",q.map(g=>`${g.categoryId}: ${g.status}`).join(", ")),y(q)},[r,e.settings.version,e.settings.categories,y,o]),M=react.useCallback(s=>{if(!r)return e.settings.categories.find(u=>u.id===s)?.defaultValue?"accepted":"pending";let c=r.decisions.find(h=>h.categoryId===s);return c?c.status:e.settings.categories.find(h=>h.id===s)?.defaultValue?"accepted":"pending"},[r,e.settings.categories]),Y=react.useCallback(()=>r,[r]),Z=react.useCallback(s=>M(s)==="accepted",[M]),K=react.useCallback(()=>{console.log("Resetting consent to default state"),P();let s=e.settings.categories.map(C=>({categoryId:C.id,status:C.required||C.defaultValue?"accepted":"rejected",timestamp:new Date,version:e.settings.version}));console.log("Initial decisions after reset:",s.map(C=>`${C.categoryId}: ${C.status}`).join(", "));let c=w(l,s,e.settings.version);d(c),i(true),t(false),e.onBannerShow?.(),console.log("Consent reset complete, banner shown, waiting for user action");},[P,e,e.settings.categories,e.settings.version]),ee={isVisible:a,showBanner:S,hideBanner:_,showPreferences:U,hidePreferences:B,acceptAll:V,rejectAll:j,updateConsent:X,getConsent:M,getAllConsent:Y,hasConsent:Z,resetConsent:K,isPreferencesVisible:p,consentRecord:r,config:e};return jsxRuntime.jsx(G.Provider,{value:ee,children:n})}function L(){let n=react.useContext(G);if(n===void 0)throw new Error("useConsentContext must be used within a ConsentProvider");return n}function T(){return L()}function me({className:n="",style:e={},onAcceptAll:a,onRejectAll:i,onManagePreferences:p,children:t}){let{isVisible:r,acceptAll:d,rejectAll:l,showPreferences:f,config:o}=T();if(!r)return null;let x=()=>{d(),a?.();},P=()=>{l(),i?.();},S=()=>{f(),p?.();},_=["consent-banner",`consent-banner--${o.banner.position}`,`consent-banner--${o.banner.layout}`,o.banner.animation?"consent-banner--animated":"",n].filter(Boolean).join(" ");return jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[o.banner.backdrop&&jsxRuntime.jsx("div",{className:"consent-backdrop"}),jsxRuntime.jsx("div",{className:_,style:e,role:"dialog","aria-labelledby":"consent-title","aria-describedby":"consent-description",children:t||jsxRuntime.jsxs("div",{className:"consent-banner__content",children:[jsxRuntime.jsxs("div",{className:"consent-banner__text",children:[jsxRuntime.jsx("h3",{id:"consent-title",className:"consent-banner__title",children:o.texts.title}),jsxRuntime.jsx("p",{id:"consent-description",className:"consent-banner__description",children:o.texts.description}),(o.texts.learnMoreUrl||o.texts.privacyPolicyUrl)&&jsxRuntime.jsxs("div",{className:"consent-banner__links",children:[o.texts.learnMoreUrl&&jsxRuntime.jsx("a",{href:o.texts.learnMoreUrl,target:"_blank",rel:"noopener noreferrer",className:"consent-banner__link",children:o.texts.learnMoreText}),o.texts.privacyPolicyUrl&&jsxRuntime.jsx("a",{href:o.texts.privacyPolicyUrl,target:"_blank",rel:"noopener noreferrer",className:"consent-banner__link",children:"Privacy Policy"})]})]}),jsxRuntime.jsxs("div",{className:"consent-banner__actions",children:[o.settings.showAcceptAll&&jsxRuntime.jsx("button",{onClick:x,className:"consent-button consent-button--primary",type:"button",children:o.texts.acceptAllText}),o.settings.showDeclineAll&&jsxRuntime.jsx("button",{onClick:P,className:"consent-button consent-button--secondary",type:"button",children:o.texts.rejectAllText}),o.settings.showManagePreferences&&jsxRuntime.jsx("button",{onClick:S,className:"consent-button consent-button--ghost",type:"button",children:o.texts.managePreferencesText})]}),o.banner.showCloseButton&&jsxRuntime.jsx("button",{onClick:P,className:"consent-banner__close","aria-label":o.texts.closeText,type:"button",children:"\xD7"}),o.texts.poweredByText&&jsxRuntime.jsx("div",{className:"consent-banner__powered-by",children:o.texts.poweredByText})]})})]})}function J({checked:n,onChange:e,disabled:a=false,size:i="md",className:p="",label:t}){let r=["consent-toggle",`consent-toggle--${i}`,n?"consent-toggle--checked":"",a?"consent-toggle--disabled":"",p].filter(Boolean).join(" ");return jsxRuntime.jsxs("label",{className:r,children:[jsxRuntime.jsx("input",{type:"checkbox",checked:n,onChange:l=>{a||e(l.target.checked);},disabled:a,className:"consent-toggle__input","aria-label":t}),jsxRuntime.jsx("span",{className:"consent-toggle__slider"}),t&&jsxRuntime.jsx("span",{className:"consent-toggle__label",children:t})]})}function W({category:n,value:e,onChange:a,disabled:i=false,className:p=""}){let t=["consent-category",i?"consent-category--disabled":"",n.required?"consent-category--required":"",p].filter(Boolean).join(" ");return jsxRuntime.jsxs("div",{className:t,children:[jsxRuntime.jsxs("div",{className:"consent-category__header",children:[jsxRuntime.jsx("h4",{className:"consent-category__name",children:n.name}),jsxRuntime.jsx(J,{checked:e,onChange:a,disabled:i,size:"md"})]}),jsxRuntime.jsx("p",{className:"consent-category__description",children:n.description}),n.required&&jsxRuntime.jsx("span",{className:"consent-category__required-badge",children:"Required"})]})}function ve({isOpen:n,onClose:e,className:a="",style:i={},showBackdrop:p=true}){let{config:t,consentRecord:r,updateConsent:d,acceptAll:l,rejectAll:f,hidePreferences:o,hideBanner:x,getConsent:P}=T();if(!n)return null;let S=()=>{o(),x(),e();},_=()=>{l(),e();},U=()=>{f(),e();},B=["consent-modal",a].filter(Boolean).join(" ");return jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[p&&jsxRuntime.jsx("div",{className:"consent-modal__backdrop",onClick:e,role:"presentation"}),jsxRuntime.jsx("div",{className:B,style:i,role:"dialog","aria-labelledby":"consent-modal-title","aria-modal":"true",children:jsxRuntime.jsxs("div",{className:"consent-modal__content",children:[jsxRuntime.jsxs("div",{className:"consent-modal__header",children:[jsxRuntime.jsx("h2",{id:"consent-modal-title",className:"consent-modal__title",children:t.texts.managePreferencesText}),jsxRuntime.jsx("button",{onClick:e,className:"consent-modal__close","aria-label":t.texts.closeText,type:"button",children:"\xD7"})]}),jsxRuntime.jsxs("div",{className:"consent-modal__body",children:[jsxRuntime.jsx("p",{className:"consent-modal__description",children:t.texts.description}),jsxRuntime.jsx("div",{className:"consent-modal__categories",children:t.settings.categories.map(y=>{let V=P(y.id)==="accepted";return jsxRuntime.jsx(W,{category:y,value:V,onChange:j=>d(y.id,j),disabled:y.required},y.id)})}),(t.texts.privacyPolicyUrl||t.texts.cookiePolicyUrl)&&jsxRuntime.jsxs("div",{className:"consent-modal__links",children:[t.texts.privacyPolicyUrl&&jsxRuntime.jsx("a",{href:t.texts.privacyPolicyUrl,target:"_blank",rel:"noopener noreferrer",className:"consent-modal__link",children:"Privacy Policy"}),t.texts.cookiePolicyUrl&&jsxRuntime.jsx("a",{href:t.texts.cookiePolicyUrl,target:"_blank",rel:"noopener noreferrer",className:"consent-modal__link",children:"Cookie Policy"})]})]}),jsxRuntime.jsx("div",{className:"consent-modal__footer",children:jsxRuntime.jsxs("div",{className:"consent-modal__actions",children:[jsxRuntime.jsx("button",{onClick:S,className:"consent-button consent-button--primary",type:"button",children:t.texts.savePreferencesText}),t.settings.showAcceptAll&&jsxRuntime.jsx("button",{onClick:_,className:"consent-button consent-button--secondary",type:"button",children:t.texts.acceptAllText}),t.settings.showDeclineAll&&jsxRuntime.jsx("button",{onClick:U,className:"consent-button consent-button--ghost",type:"button",children:t.texts.rejectAllText})]})})]})})]})}var xe={categories:[{id:"necessary",name:"Necessary",description:"Essential cookies required for basic website functionality.",type:"necessary",required:true,defaultValue:true},{id:"analytics",name:"Analytics",description:"Cookies that help us understand how visitors interact with our website.",type:"analytics",required:false,defaultValue:false},{id:"marketing",name:"Marketing",description:"Cookies used to deliver personalized advertisements.",type:"marketing",required:false,defaultValue:false},{id:"preferences",name:"Preferences",description:"Cookies that remember your preferences and settings.",type:"preferences",required:false,defaultValue:false}],version:"1.0.0",expirationDays:365,storageKey:"asafarim-privacy-consent",showDeclineAll:true,showAcceptAll:true,showManagePreferences:true,autoShowDelay:1e3,respectDoNotTrack:true},he={position:"bottom",layout:"banner",showCloseButton:true,showCompanyLogo:false,blocking:false,animation:true,backdrop:false},Pe={title:"We value your privacy",description:"We use cookies and similar technologies to provide the best experience on our website. Some are necessary for functionality, while others help us understand usage and improve our services.",acceptAllText:"Accept All",rejectAllText:"Reject All",managePreferencesText:"Manage Preferences",savePreferencesText:"Save Preferences",closeText:"Close",learnMoreText:"Learn More",poweredByText:"Powered by @asafarim/react-privacy-consent"},Xe={settings:xe,banner:he,texts:Pe};exports.ConsentBanner=me;exports.ConsentCategory=W;exports.ConsentModal=ve;exports.ConsentProvider=Ce;exports.ConsentToggle=J;exports.applyConsentTheme=F;exports.createConsentRecord=w;exports.defaultBannerConfig=he;exports.defaultConsentTexts=Pe;exports.defaultPrivacyConsentConfig=Xe;exports.defaultPrivacySettings=xe;exports.generateSessionId=$;exports.getConsentValue=oe;exports.getDarkTheme=le;exports.getDefaultTheme=ce;exports.hasExpiredConsent=re;exports.isValidConsentRecord=te;exports.mergeConsentDecisions=se;exports.removeConsentTheme=ie;exports.sanitizeConsentRecord=ae;exports.useConsent=T;exports.useConsentContext=L;exports.useConsentStorage=z;//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map